{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"295dc419-0333-4753-b47f-ae720fded18d","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4439"}],"$conditionOutputs":[{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"],"$$hashKey":"object:4486"}],"$id":"638506e3-974e-440c-a78e-421e9d1c3367","$connId":"con_3","$invalid":false,"$$hashKey":"object:4467"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"da5675f4-75d5-4fd2-a479-96c4d8e74a62","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"function run(raw){\n    raw = {\n        tunnelOriginator : `{{tunnel.originator}}`,\n        tunnelOwner      : `{{tunnel.owner}}`,\n        stagingEnvironment : false\n    }\n    /*\n        {\n            \"ni\" : \"<b>\", OK\n            \"nf\" : \"</b>\", OK\n            \"ii\" : \"<i>\", OK\n            \"if\" : \"</i>\", OK\n            \"channel\"     : \"Chat / WhatsApp / Default\", OK\n            \"environment\" : \"Dev / Tst / Hmg / Stg / Prd\",\n            \"originator\"  : \"5548996260373@wa.gw.msging.net\", OK\n            \"regex\"       : {\n                \"forHuman\" : \"(humano)\"\n                \"forLeave\" : \"(sair)\"  \n            }\n        }\n    */ \n   try \n    {\n        if(!raw)\n            throw Error(\"Raw é vazio\")  \n\n        let config = {}\n\n        \n        config.environment  = discoverEnvironment(raw)\n        config.originator   = config.environment != \"Dev\" ? raw.originator : '{{config.client}}'\n\n        config.channel      =  discoverChannel(config)\n        let boldItalic      = {}\n\n        boldItalic = discoverN(config)\n        config.ni  = boldItalic.ni\n        config.nf  = boldItalic.nf\n\n        boldItalic = discoverI(config)\n        config.ii  = boldItalic.ii\n        config.if  = boldItalic.if\n\n        let dataWit = new Date()\n        let month   = dataWit.getMonth()+1\n        month       = dataWit.getMonth().toString().length == 1 ? '0'+ month : month\n        let day     = dataWit.getDate().toString().length == 1 ? '0'+dataWit.getDate() : dataWit.getDate()\n        dataWit     = dataWit.getFullYear().toString() + (month).toString() + day.toString()\n\n        config.witUrl = `https://api.wit.ai/message?v=${dataWit}&`\n        config.witAuthorization = `Bearer 437L4LEIZKDS5LLQ6VFE6CCSHNAR2B5D` \n\n\n        return config\n    } \n    catch (error) \n    {\n        return error.toString()   \n    }\n}\n\nfunction discoverChannel(config)\n{\n    if(config.originator.search('@wa.gw.msging.net') != -1)\n        return 'WhatsApp'\n    \n    if(config.originator.search('@0mn.io') != -1)\n        return 'Chat'\n    \n    return 'Default'\n}\n\nfunction discoverN(config)\n{\n    let bold = {\n        \"WhatsApp\" : { ni : \"*\", nf : \"*\" },\n        \"Chat\"     : { ni : \"<b>\", nf : \"</b>\" },\n        \"Default\"  : { ni : \"\", nf : \"\" }\n    }\n    return bold[config.channel]\n}\n\nfunction discoverI(config)\n{\n    let bold = {\n        \"WhatsApp\" : { ii : \"_\", if : \"_\" },\n        \"Chat\"     : { ii : \"<i>\", if : \"</i>\" },\n        \"Default\"  : { ii : \"\", if : \"\" }\n    }\n    return bold[config.channel]\n} \n\nfunction discoverEnvironment(raw)\n{\n    let debugEnvironment = (raw.tunnelOwner.length == 0)\n    let homologEnvironment = (raw.tunnelOwner.match(/(hmg|homolog|homg)/gi))\n    let developmentEnvironment = (raw.tunnelOwner.match(/(dev|bet)/gi)) \n    let stagingEnvironment = (raw.stagingEnvironment)\n\n    if(debugEnvironment)\n        return 'Dev'\n\n    if(homologEnvironment)\n        return 'Hmg'\n\n    if(developmentEnvironment)\n        return 'Tst'\n\n    if(stagingEnvironment)\n        return 'Stg'\n\n    return 'Prd'\n}","inputVariables":[],"outputVariable":"config"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-92247030-b3d2-95dc-fa8a-cad9db315cb5","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"240px","left":"306px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d66073c8-ed10-47e1-9856-13ba9ae04cb1","type":"text/plain"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"92c94506-718a-4b5e-9f85-027d1c32ec69","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[],"id":"fallback","$title":"Exceções","$position":{"top":"90px","left":"307px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"9b305b55-4927-4901-855c-7c4bc0e4d01e","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false,"$$hashKey":"object:3986"},{"action":{"$id":"8a08d91a-8312-4343-8f32-caf68ed475e2","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! {{contact.name}}!\nSeja bem-vindo(a)!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! {{contact.name}}!\nSeja bem-vindo(a)!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false,"$$hashKey":"object:3987"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"77688760-c745-4c3e-acaa-7253f7ed5cb3","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3990"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"abbf7008-3a26-4445-94ca-705d4329b6aa","type":"ProcessHttp","$title":"Requisição HTTP","$invalid":false,"settings":{"headers":{"Authorization":"{{config@witAuthorization}}"},"method":"GET","uri":"{{config@witUrl}}q={{input.content}}","responseStatusVariable":"status","responseBodyVariable":"response"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF4A1E","label":"ProcessHttp","id":"blip-tag-18351abb-209c-0ef0-2ebf-eb695b546455","canChangeBackground":false}],"id":"welcome","$title":"Boas vindas","$position":{"top":"240px","left":"642px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"action":{"$id":"1d473cae-9330-44b4-9523-ce8cbbaf1bc5","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"b8faae1b-0a97-4cef-b4eb-7435ea87fe74","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8cfd9006-fc5d-449a-9d83-5ff342eebd03","type":"text/plain"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[],"id":"error","$title":"Erro padrão","$position":{"top":"90px","left":"645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}